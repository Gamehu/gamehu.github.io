<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/IMG_4038-32.jpeg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/IMG_4038.jpeg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.gamehu.run","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
<meta property="og:type" content="website">
<meta property="og:title" content="正儿八经 - 资深Java&#x2F;React工程师">
<meta property="og:url" content="https://www.gamehu.run/index.html">
<meta property="og:site_name" content="正儿八经 - 资深Java&#x2F;React工程师">
<meta property="og:description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Gamehu">
<meta property="article:tag" content="Java开发, React工程师, 全栈开发, 求职, 软件工程师">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.gamehu.run/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>正儿八经 - 资深Java/React工程师</title>
  




<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/ilyabirman-likely@2/release/likely.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>
#needsharebutton-postbottom {
  cursor: pointer;
  height: 26px;
  margin-top: 10px;
  position: relative;
}
#needsharebutton-postbottom .btn {
  border: 1px solid $btn-default-border-color;
  border-radius: 3px;
  display: initial;
  padding: 1px 4px;
}
</style>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">正儿八经 - 资深Java/React工程师</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">浪起来？技术博客与求职信息</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Gamehu"
      src="/images/IMG_4038.jpeg">
  <p class="site-author-name" itemprop="name">Gamehu</p>
  <div class="site-description" itemprop="description">10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">193</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">114</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/gamehu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gamehu" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gamehu520@gmail.com" title="E-Mail → mailto:gamehu520@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/gamehu/gamehu.github.io" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/03/07/ETL%E5%A4%8D%E4%B9%A0(1)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/07/ETL%E5%A4%8D%E4%B9%A0(1)/" class="post-title-link" itemprop="url">ETL复习(1)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-07 22:36:00" itemprop="dateCreated datePublished" datetime="2025-03-07T22:36:00+08:00">2025-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">面试知识梳理</span>
  <span class="sub-tag">第一篇</span>
</div>

<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近找工作，有些大数据岗位我想投，但是奈何之前的工作内容大数据不是主业，大数据经验不够看，我最早要追溯到15年当时spark+hive，然后17年的storm+hbase，到最近的flink+ck，我觉得我努把力看能不能够一够大数据相关的岗位。</p>
<h2 id="基础环境准备"><a href="#基础环境准备" class="headerlink" title="基础环境准备"></a>基础环境准备</h2><p>把我给媳妇儿配的打LOL的电脑，偷偷拿来用一用，当成小型服务器，反正性能对LOL来说，很过剩了，不影响。</p>
<p>我之前鼓捣其它技术的时候就在电脑上装了虚拟机，所以也不折腾了，直接装个ubuntu，然后装个docker+docker compose，就差不多了。</p>
<h3 id="docker镜像源"><a href="#docker镜像源" class="headerlink" title="docker镜像源"></a>docker镜像源</h3><p>单独说下，因为docker默认用的国外的镜像源所以安装后几乎是不可用的，这时候需要配置国内的镜像。<br>要注意验证镜像源，比如通过curl等命令，看是否能正常访问是否能免验证访问，我就是被阿里云的镜像加速器耽搁了小半小时，就是按照官方的配置始终403，最后才发现，原理阿里前几个月更新了协议，大概意思是，不再支持外部直接用加速镜像，而是支持阿里云本身的产品使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 1. 验证镜像源</span><br><span class="line">curl 镜像源 </span><br><span class="line"># 2. 添加镜像源</span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://xxxx&quot;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 3. 使其生效</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line"># 4. 查看镜像是否修改成功</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"># 5. 拉取镜像验证</span><br><span class="line">docker pull xxx</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="安装CK"><a href="#安装CK" class="headerlink" title="安装CK"></a>安装CK</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"># 1. 获取ck镜像</span><br><span class="line"> docker pull clickhouse/clickhouse-server</span><br><span class="line"># 2. 添加ck需要的目录</span><br><span class="line">mkdir -p /data/clickhouse/data /data/clickhouse/config /data/clickhouse/logs</span><br><span class="line"></span><br><span class="line"># 3. ck的配置</span><br><span class="line">cat &gt; /data/clickhouse/config/config.xml &lt;&lt; EOF</span><br><span class="line">  &lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">  &lt;yandex&gt;</span><br><span class="line">      &lt;logger&gt;</span><br><span class="line">          &lt;level&gt;information&lt;/level&gt;</span><br><span class="line">          &lt;log&gt;/var/log/clickhouse-server/clickhouse-server.log&lt;/log&gt;</span><br><span class="line">          &lt;errorlog&gt;/var/log/clickhouse-server/clickhouse-server.err.log&lt;/errorlog&gt;</span><br><span class="line">      &lt;/logger&gt;</span><br><span class="line"></span><br><span class="line">      &lt;http_port&gt;8123&lt;/http_port&gt;</span><br><span class="line">      &lt;tcp_port&gt;9000&lt;/tcp_port&gt;</span><br><span class="line">      &lt;interserver_http_port&gt;9009&lt;/interserver_http_port&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;max_connections&gt;4096&lt;/max_connections&gt;</span><br><span class="line">      &lt;keep_alive_timeout&gt;10&lt;/keep_alive_timeout&gt;</span><br><span class="line">      &lt;max_concurrent_queries&gt;100&lt;/max_concurrent_queries&gt;</span><br><span class="line">      &lt;uncompressed_cache_size&gt;8589934592&lt;/uncompressed_cache_size&gt;</span><br><span class="line">      &lt;mark_cache_size&gt;5368709120&lt;/mark_cache_size&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;path&gt;/var/lib/clickhouse/&lt;/path&gt;</span><br><span class="line">      &lt;tmp_path&gt;/var/lib/clickhouse/tmp/&lt;/tmp_path&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;user_directories&gt;</span><br><span class="line">          &lt;users_xml&gt;</span><br><span class="line">              &lt;path&gt;/etc/clickhouse-server/users.xml&lt;/path&gt;</span><br><span class="line">          &lt;/users_xml&gt;</span><br><span class="line">      &lt;/user_directories&gt;</span><br><span class="line"></span><br><span class="line">      &lt;timezone&gt;UTC&lt;/timezone&gt;</span><br><span class="line">  &lt;/yandex&gt;</span><br><span class="line">  EOF</span><br><span class="line"></span><br><span class="line"># 4. ck用户管理</span><br><span class="line">    cat &gt; /data/clickhouse/config/users.xml &lt;&lt; EOF</span><br><span class="line">      &lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">      &lt;yandex&gt;</span><br><span class="line">          &lt;users&gt;</span><br><span class="line">              &lt;default&gt;</span><br><span class="line">                  &lt;password&gt;yourpassword&lt;/password&gt;</span><br><span class="line">                  &lt;networks&gt;</span><br><span class="line">                      &lt;ip&gt;::/0&lt;/ip&gt;</span><br><span class="line">                  &lt;/networks&gt;</span><br><span class="line">                  &lt;profile&gt;default&lt;/profile&gt;</span><br><span class="line">                  &lt;quota&gt;default&lt;/quota&gt;</span><br><span class="line">              &lt;/default&gt;</span><br><span class="line">          &lt;/users&gt;</span><br><span class="line"></span><br><span class="line">          &lt;profiles&gt;</span><br><span class="line">              &lt;default&gt;</span><br><span class="line">                  &lt;max_memory_usage&gt;10000000000&lt;/max_memory_usage&gt;</span><br><span class="line">                  &lt;use_uncompressed_cache&gt;0&lt;/use_uncompressed_cache&gt;</span><br><span class="line">                  &lt;load_balancing&gt;random&lt;/load_balancing&gt;</span><br><span class="line">              &lt;/default&gt;</span><br><span class="line">          &lt;/profiles&gt;</span><br><span class="line"></span><br><span class="line">          &lt;quotas&gt;</span><br><span class="line">              &lt;default&gt;</span><br><span class="line">                  &lt;interval&gt;</span><br><span class="line">                      &lt;duration&gt;3600&lt;/duration&gt;</span><br><span class="line">                      &lt;queries&gt;0&lt;/queries&gt;</span><br><span class="line">                      &lt;errors&gt;0&lt;/errors&gt;</span><br><span class="line">                      &lt;result_rows&gt;0&lt;/result_rows&gt;</span><br><span class="line">                      &lt;read_rows&gt;0&lt;/read_rows&gt;</span><br><span class="line">                      &lt;execution_time&gt;0&lt;/execution_time&gt;</span><br><span class="line">                  &lt;/interval&gt;</span><br><span class="line">              &lt;/default&gt;</span><br><span class="line">          &lt;/quotas&gt;</span><br><span class="line">      &lt;/yandex&gt;</span><br><span class="line">      EOF</span><br><span class="line"></span><br><span class="line"># 5.运行容器</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">  --name clickhouse-server \</span><br><span class="line">  --ulimit nofile=262144:262144 \</span><br><span class="line">  -p 8123:8123 \</span><br><span class="line">  -p 9000:9000 \</span><br><span class="line">  -p 9009:9009 \</span><br><span class="line">  -v /data/clickhouse/data:/var/lib/clickhouse \</span><br><span class="line">  -v /data/clickhouse/config/config.xml:/etc/clickhouse-server/config.xml \</span><br><span class="line">  -v /data/clickhouse/config/users.xml:/etc/clickhouse-server/users.xml \</span><br><span class="line">  -v /data/clickhouse/logs:/var/log/clickhouse-server \</span><br><span class="line">  --restart=always \</span><br><span class="line">  clickhouse/clickhouse-server:latest</span><br><span class="line"></span><br><span class="line"># 6. 测试是否可用（内部）</span><br><span class="line">  docker exec -it clickhouse-server clickhouse-client --password yourpassword</span><br><span class="line"></span><br><span class="line"># 7.暴露到外部可访问，由于不想每次run都写一长串，也为了后续方便管理其它容器，把docker compose装上</span><br><span class="line">  apt update</span><br><span class="line">  apt install -y docker-compose</span><br><span class="line"># 8.compose文件编写，别忘了暴露environment</span><br><span class="line">  nano /data/clickhouse/docker-compose.yml</span><br><span class="line">  </span><br><span class="line">  version: &#x27;3&#x27;</span><br><span class="line">    services:</span><br><span class="line">      clickhouse:</span><br><span class="line">        image: clickhouse/clickhouse-server:latest</span><br><span class="line">        container_name: clickhouse-server</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">          - &quot;8123:8123&quot;</span><br><span class="line">          - &quot;9000:9000&quot;</span><br><span class="line">          - &quot;9009:9009&quot;</span><br><span class="line">        volumes:</span><br><span class="line">          - /data/clickhouse/data:/var/lib/clickhouse</span><br><span class="line">          - /data/clickhouse/config/config.xml:/etc/clickhouse-server/config.xml</span><br><span class="line">          - /data/clickhouse/config/users.xml:/etc/clickhouse-server/users.xml</span><br><span class="line">          - /data/clickhouse/logs:/var/log/clickhouse-server</span><br><span class="line">        environment:</span><br><span class="line">          - CLICKHOUSE_USER=default</span><br><span class="line">          - CLICKHOUSE_PASSWORD=xxxx</span><br><span class="line">        ulimits:</span><br><span class="line">          nofile:</span><br><span class="line">            soft: 262144</span><br><span class="line">            hard: 262144</span><br><span class="line"># 删除ck容器后重启</span><br><span class="line">  cd /data/clickhouse</span><br><span class="line">  docker-compose up -d</span><br><span class="line"># 9. 看是否正常返回</span><br><span class="line">  curl &quot;http://xx:8123/?user=default&amp;password=xx&amp;query=SELECT%201&quot;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="还有待续…"><a href="#还有待续…" class="headerlink" title="还有待续…."></a>还有待续….</h2><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.coderjia.cn/archives/dba3f94c-a021-468a-8ac6-e840f85867ea">https://www.coderjia.cn/archives/dba3f94c-a021-468a-8ac6-e840f85867ea</a><br><a target="_blank" rel="noopener" href="https://hub.docker.com/r/clickhouse/clickhouse-server/">https://hub.docker.com/r/clickhouse/clickhouse-server/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/03/04/Prompt-Engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/04/Prompt-Engineering/" class="post-title-link" itemprop="url">Prompt Engineering</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-04 11:11:01" itemprop="dateCreated datePublished" datetime="2025-03-04T11:11:01+08:00">2025-03-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="ai-tag">AI</span>
  <span class="sub-tag">第四篇</span>
</div>

<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>最近准备面试嘛，看到好些JD里，特别是关于大模型的JD，里面有个技能要求Prompt Engineering。刚好我也有兴趣，平时也是claude.ai和chatgpt、deepseek的重度用户，美元都花了好些，问题问的多了，慢慢的知道问题描述的准确性与预期的答案相关性确实很大。确实感觉Prompt Engineering（提示词工程）已经成为一项重要技能。无论你是开发者、内容创作者还是普通用户，掌握这项技能都能帮助你更有效地与AI交流，获得更满意的结果。刚好借此JD机会，更深入的学习下怎么才能写好Prompt。</p>
<h2 id="什么是Prompt-Engineering？"><a href="#什么是Prompt-Engineering？" class="headerlink" title="什么是Prompt Engineering？"></a>什么是Prompt Engineering？</h2><h3 id="基本概念解释"><a href="#基本概念解释" class="headerlink" title="基本概念解释"></a>基本概念解释</h3><p>Prompt Engineering是指设计和优化输入到AI模型（如ChatGPT、Claude等）的提示词的过程，目的是引导AI生成更准确、更符合预期的输出内容。</p>
<p>简单来说，就像我们与人交流时，清晰表达自己的需求会得到更好的回应一样，与AI的交流也需要”说人话”，而Prompt Engineering就是学习如何更好地”对AI说话”的艺术。</p>
<h3 id="为什么Prompt-Engineering很重要？"><a href="#为什么Prompt-Engineering很重要？" class="headerlink" title="为什么Prompt Engineering很重要？"></a>为什么Prompt Engineering很重要？</h3><ul>
<li><strong>节省时间</strong>：好的提示词能直接获得理想结果，减少反复尝试的时间</li>
<li><strong>提高质量</strong>：精心设计的提示词能显著提升AI输出的质量和准确度</li>
<li><strong>解锁潜能</strong>：掌握高级技巧后，你可以让AI完成更复杂的任务</li>
</ul>
<h2 id="Prompt-Engineering的基础知识"><a href="#Prompt-Engineering的基础知识" class="headerlink" title="Prompt Engineering的基础知识"></a>Prompt Engineering的基础知识</h2><h3 id="提示词的基本结构"><a href="#提示词的基本结构" class="headerlink" title="提示词的基本结构"></a>提示词的基本结构</h3><p>一个好的提示词通常包含以下几个要素：</p>
<ol>
<li><strong>明确的指令</strong>：清楚地告诉AI你想要它做什么</li>
<li><strong>上下文信息</strong>：提供必要的背景知识</li>
<li><strong>输入数据</strong>：需要AI处理的具体内容</li>
<li><strong>输出格式</strong>：期望AI如何组织和呈现结果</li>
</ol>
<h3 id="简单例子对比"><a href="#简单例子对比" class="headerlink" title="简单例子对比"></a>简单例子对比</h3><p><strong>不好的提示词</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">写一篇关于AI的科普文章</span><br></pre></td></tr></table></figure>

<p><strong>好的提示词</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请写一篇800字左右的科普文章，主题是&quot;人工智能的发展历程&quot;，适合完全不动技术的人阅读，</span><br><span class="line">包含三个主要发展阶段，使用生动的比喻和案例解释专业概念，并在结尾提出对未来的展望。</span><br></pre></td></tr></table></figure>

<h2 id="提升Prompt效果的核心技巧"><a href="#提升Prompt效果的核心技巧" class="headerlink" title="提升Prompt效果的核心技巧"></a>提升Prompt效果的核心技巧</h2><h3 id="1-清晰具体"><a href="#1-清晰具体" class="headerlink" title="1. 清晰具体"></a>1. 清晰具体</h3><p>越具体的提示词越能得到准确的回答。包括具体描述：</p>
<ul>
<li>所需输出的长度（字数&#x2F;段落数）</li>
<li>目标受众（专业水平&#x2F;年龄段）</li>
<li>风格（正式&#x2F;轻松&#x2F;创意）</li>
<li>结构（要点&#x2F;段落&#x2F;表格）</li>
</ul>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请用简单的语言向我10岁女儿解释光合作用，不超过200字，使用至少2个生活中的比喻，避免使用专业术语。</span><br></pre></td></tr></table></figure>

<h3 id="2-提供示例（少样本学习）"><a href="#2-提供示例（少样本学习）" class="headerlink" title="2. 提供示例（少样本学习）"></a>2. 提供示例（少样本学习）</h3><p>通过提供几个输入-输出的示例，可以更好地引导AI理解你的期望。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">请按照以下格式将这些句子翻译成英文：</span><br><span class="line"></span><br><span class="line">中文：我喜欢吃苹果。</span><br><span class="line">英文：I like to eat apples.</span><br><span class="line"></span><br><span class="line">中文：明天我要去北京旅游。</span><br><span class="line">英文：I will travel to Beijing tomorrow.</span><br><span class="line"></span><br><span class="line">中文：这本书很有趣，我想推荐给你。</span><br><span class="line">英文：</span><br></pre></td></tr></table></figure>

<h3 id="3-角色设定"><a href="#3-角色设定" class="headerlink" title="3. 角色设定"></a>3. 角色设定</h3><p>让AI扮演特定角色，能使回答更符合特定专业或风格需求。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请你扮演一位经验丰富的营销专家，分析我的产品定位问题，并提供改进建议。我的产品是一款...</span><br></pre></td></tr></table></figure>

<h3 id="4-分步骤思考"><a href="#4-分步骤思考" class="headerlink" title="4. 分步骤思考"></a>4. 分步骤思考</h3><p>引导AI一步步思考问题，可以获得更准确的结果，特别是对于复杂问题。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">请帮我解决这个数学问题，在回答前，请先分析问题，列出已知条件，然后逐步推导求解过程，最后给出结论。</span><br><span class="line"></span><br><span class="line">问题：一个圆柱形水箱，底面积为3平方米，高为2米。现在水箱中有水，深度为1.5米。如果以每分钟0.1立方米的速度向水箱中注水，需要多少分钟才能将水箱装满？</span><br></pre></td></tr></table></figure>

<h3 id="5-指定输出格式"><a href="#5-指定输出格式" class="headerlink" title="5. 指定输出格式"></a>5. 指定输出格式</h3><p>明确要求特定的输出格式，使结果更易于使用。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">请分析这家公司的优势和劣势，并以下面的JSON格式输出结果：</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;公司名称&quot;: &quot;XX科技&quot;,</span><br><span class="line">  &quot;优势&quot;: [&quot;优势1&quot;, &quot;优势2&quot;, &quot;优势3&quot;],</span><br><span class="line">  &quot;劣势&quot;: [&quot;劣势1&quot;, &quot;劣势2&quot;, &quot;劣势3&quot;],</span><br><span class="line">  &quot;改进建议&quot;: [&quot;建议1&quot;, &quot;建议2&quot;, &quot;建议3&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="进阶技巧"><a href="#进阶技巧" class="headerlink" title="进阶技巧"></a>进阶技巧</h2><h3 id="链式思维（Chain-of-Thought）"><a href="#链式思维（Chain-of-Thought）" class="headerlink" title="链式思维（Chain-of-Thought）"></a>链式思维（Chain-of-Thought）</h3><p>引导AI展示其思考过程，对于复杂推理特别有效。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">问题：小明有12个苹果，他给了小红3个，又给了小李他手中苹果数量的一半，最后他还剩下多少个苹果？请一步一步地思考，解释每一步的计算过程和原因。</span><br></pre></td></tr></table></figure>

<h3 id="思维树（Tree-of-Thoughts）"><a href="#思维树（Tree-of-Thoughts）" class="headerlink" title="思维树（Tree of Thoughts）"></a>思维树（Tree of Thoughts）</h3><p>引导AI探索多种可能性和解决方案路径。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请用思维树的方式分析我创业的三个不同选择（开咖啡店、做在线教育、开发APP），每个选择探索三个可能的发展路径，考虑不同条件下的结果，然后总结最优选择。</span><br></pre></td></tr></table></figure>

<h3 id="自我评估和修正"><a href="#自我评估和修正" class="headerlink" title="自我评估和修正"></a>自我评估和修正</h3><p>让AI评估自己的输出并进行改进。</p>
<p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请写一篇关于气候变化的短文，然后评估这篇文章的优缺点，并基于评估给出一个改进版本。</span><br></pre></td></tr></table></figure>

<h2 id="常见应用场景实战"><a href="#常见应用场景实战" class="headerlink" title="常见应用场景实战"></a>常见应用场景实战</h2><h3 id="内容创作"><a href="#内容创作" class="headerlink" title="内容创作"></a>内容创作</h3><h4 id="写作辅助"><a href="#写作辅助" class="headerlink" title="写作辅助"></a>写作辅助</h4><p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请为我的科技博客生成一篇文章大纲，主题是&quot;5G技术如何改变我们的生活&quot;。大纲应包含引言、3-5个主要部分、每部分2-3个小节，以及结论。每个小节都需要有简短描述。</span><br></pre></td></tr></table></figure>

<h4 id="创意生成"><a href="#创意生成" class="headerlink" title="创意生成"></a>创意生成</h4><p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我正在设计一个以&quot;海洋保护&quot;为主题的儿童故事书。请创作5个可能的故事情节，每个情节包含主角描述、基本冲突和教育意义。</span><br></pre></td></tr></table></figure>

<h3 id="数据分析与处理"><a href="#数据分析与处理" class="headerlink" title="数据分析与处理"></a>数据分析与处理</h3><p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">我有一组销售数据，包含产品名称、月份和销售额。请帮我分析这些数据，找出销售趋势，并提出改进建议。数据如下：</span><br><span class="line">[数据内容]</span><br></pre></td></tr></table></figure>

<h3 id="代码辅助"><a href="#代码辅助" class="headerlink" title="代码辅助"></a>代码辅助</h3><p><strong>例子</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请编写一个Python函数，用于分析文本情感倾向。函数应接受一段文本作为输入，返回积极、消极或中性的评价以及置信度分数。请包含必要的注释和简单的使用示例。</span><br></pre></td></tr></table></figure>

<h2 id="常见问题与解决方法"><a href="#常见问题与解决方法" class="headerlink" title="常见问题与解决方法"></a>常见问题与解决方法</h2><h3 id="如何处理AI回答过于笼统或离题？"><a href="#如何处理AI回答过于笼统或离题？" class="headerlink" title="如何处理AI回答过于笼统或离题？"></a>如何处理AI回答过于笼统或离题？</h3><ul>
<li><strong>解决方法</strong>：增加具体细节，使用引导性问题，明确输出要求</li>
<li><strong>例子</strong>：原提示”谈谈人工智能的未来”可改为”请从就业、教育和伦理三个方面，具体分析人工智能在未来10年可能带来的社会变革。每个方面请提供至少两个具体的预测和可能的应对策略。”</li>
</ul>
<h3 id="如何避免AI生成的内容过于冗长？"><a href="#如何避免AI生成的内容过于冗长？" class="headerlink" title="如何避免AI生成的内容过于冗长？"></a>如何避免AI生成的内容过于冗长？</h3><ul>
<li><strong>解决方法</strong>：明确字数限制，要求简洁回答，指定重点内容</li>
<li><strong>例子</strong>：”请用不超过300字，总结量子计算的核心原理，重点解释量子比特和量子纠缠这两个概念。”</li>
</ul>
<h3 id="如何使AI生成更创新性的内容？"><a href="#如何使AI生成更创新性的内容？" class="headerlink" title="如何使AI生成更创新性的内容？"></a>如何使AI生成更创新性的内容？</h3><ul>
<li><strong>解决方法</strong>：明确要求原创思路，设置情景约束，激励思维发散</li>
<li><strong>例子</strong>：”请提出5种从未出现过的智能家居产品创意，每种产品都需要融合至少两种现有技术，并解决一个特定的家庭难题。”</li>
</ul>
<h3 id="免费学习资源"><a href="#免费学习资源" class="headerlink" title="免费学习资源"></a>免费学习资源</h3><ol>
<li><p><strong>免费课程与教程</strong></p>
<ul>
<li>OpenAI的Prompt Engineering指南 (官网免费提供)</li>
<li>李宏毅教授的”Large Language Model”课程 (YouTube完整课程)</li>
<li>Khan Academy的AI基础知识 (免费教育平台)</li>
<li>Hugging Face的NLP教程 (官方文档免费)</li>
<li>Coursera上的免费AI课程 (可以免费旁听)</li>
</ul>
</li>
<li><p><strong>免费电子书与指南</strong></p>
<ul>
<li>《Prompt Engineering Guide》by Lilian Weng (在线免费阅读)</li>
<li>Dair.ai的Prompt Engineering Guide (GitHub上免费)</li>
<li>Github上的awesome-chatgpt-prompts开源仓库</li>
<li>OpenAI官方的最佳实践指南</li>
</ul>
</li>
<li><p><strong>免费在线社区与资源</strong></p>
<ul>
<li>GitHub上的Prompt Engineering资源库</li>
<li>Reddit的r&#x2F;PromptEngineering社区</li>
<li>Discord的公开AI社区讨论组</li>
</ul>
</li>
<li><p><strong>免费网站</strong></p>
<ul>
<li>​免费课程：DeepLearning.AI 的《ChatGPT Prompt Engineering for Developers》</li>
<li>​工具包：LangChain 的 Prompt 模板库、Promptify（开源 Prompt 工具）</li>
<li>​论文库：Papers with Code 中搜索 “Prompt Engineering”</li>
<li><a target="_blank" rel="noopener" href="https://promptperfect.jina.ai/">https://promptperfect.jina.ai/</a></li>
<li><a target="_blank" rel="noopener" href="https://learn.deeplearning.ai/">https://learn.deeplearning.ai/</a></li>
<li><a target="_blank" rel="noopener" href="https://paperswithcode.com/paper/chain-of-thought-prompting-elicits-reasoning">https://paperswithcode.com/paper/chain-of-thought-prompting-elicits-reasoning</a></li>
<li><a target="_blank" rel="noopener" href="https://promptbase.com/">https://promptbase.com/</a></li>
</ul>
</li>
</ol>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>Prompt Engineering不仅是一项技术技能，更是一门艺术。通过不断实践和调整，你会发现与AI交流的效率和质量都会显著提升。记住，最好的学习方式是实践——从今天开始尝试这些技巧，记录效果，持续改进。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/03/02/%E9%9D%A2%E8%AF%95%E9%A2%98-HTTPS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/02/%E9%9D%A2%E8%AF%95%E9%A2%98-HTTPS/" class="post-title-link" itemprop="url">面试题-HTTPS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-02 09:31:07" itemprop="dateCreated datePublished" datetime="2025-03-02T09:31:07+08:00">2025-03-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">面试</span>
  <span class="sub-tag">第一篇</span>
</div>

<p><img src="/2025/03/02/%E9%9D%A2%E8%AF%95%E9%A2%98-HTTPS/1.jpeg" alt="源自ByteByteGo"></p>
<h1 id="HTTPS工作原理：三个关键步骤解"><a href="#HTTPS工作原理：三个关键步骤解" class="headerlink" title="HTTPS工作原理：三个关键步骤解"></a>HTTPS工作原理：三个关键步骤解</h1><p>根据图中内容，HTTPS（Hypertext Transfer Protocol Secure）的工作原理可以分为三个关键步骤：</p>
<h3 id="服务器证书检查（Server-Certificate-Check）"><a href="#服务器证书检查（Server-Certificate-Check）" class="headerlink" title="服务器证书检查（Server Certificate Check）"></a>服务器证书检查（Server Certificate Check）</h3><p>这是建立安全连接的第一步：</p>
<ul>
<li>客户端（浏览器）向服务器发送”HELLO”消息</li>
<li>服务器回应”HELLO”</li>
<li>服务器发送自己的证书给客户端</li>
<li>客户端向证书颁发机构（CA）发送请求，确认此证书是否有效</li>
<li>CA回应”YES”，表示证书合法</li>
</ul>
<p>这一步确保了用户正在与合法网站通信，而不是某个冒充者。证书颁发机构作为可信第三方，保证了服务器的身份。</p>
<h3 id="密钥交换（Key-Exchange）"><a href="#密钥交换（Key-Exchange）" class="headerlink" title="密钥交换（Key Exchange）"></a>密钥交换（Key Exchange）</h3><p>验证服务器身份后，需要建立加密通信：</p>
<ul>
<li>客户端从服务器证书中提取服务器的公钥</li>
<li>客户端创建一个会话密钥</li>
<li>客户端告知服务器它支持的密码套件（”I know A,B,C,D cipher suites”）</li>
<li>服务器选择一个密码套件（”OK, Let’s use C”）</li>
<li>客户端使用服务器的公钥和选定的密码套件加密会话密钥</li>
<li>服务器使用自己的私钥解密，获得会话密钥</li>
</ul>
<p>此时，服务器也拥有了会话密钥，为后续加密通信做好准备。</p>
<h3 id="加密通信隧道（Encrypted-Tunnel）"><a href="#加密通信隧道（Encrypted-Tunnel）" class="headerlink" title="加密通信隧道（Encrypted Tunnel）"></a>加密通信隧道（Encrypted Tunnel）</h3><p>在完成前两步后：</p>
<ul>
<li>客户端和服务器双方都拥有相同的会话密钥</li>
<li>客户端发送的数据使用会话密钥加密</li>
<li>服务器接收数据后使用相同的会话密钥解密</li>
<li>服务器发送给客户端的数据也使用相同的会话密钥加密</li>
<li>客户端接收后使用会话密钥解密</li>
</ul>
<p>这形成了一个安全的加密通信隧道，即使数据在传输过程中被拦截，没有会话密钥的第三方也无法解密内容，保证了数据传输的安全性。</p>
<h2 id="PS：从输入URL到页面显示的完整过程"><a href="#PS：从输入URL到页面显示的完整过程" class="headerlink" title="PS：从输入URL到页面显示的完整过程"></a>PS：从输入URL到页面显示的完整过程</h2><ol>
<li>URL解析：浏览器解析URL，确定协议（HTTP&#x2F;HTTPS）、域名和路径</li>
<li>DNS解析：浏览器查询DNS服务器，将域名转换为IP地址<ul>
<li>首先检查浏览器缓存</li>
<li>然后检查操作系统缓存</li>
<li>接着查询本地DNS服务器</li>
<li>必要时进行递归查询</li>
</ul>
</li>
<li>建立TCP连接：浏览器与服务器建立TCP连接（三次握手）<ul>
<li>客户端发送SYN包</li>
<li>服务器回应SYN-ACK包</li>
<li>客户端发送ACK包</li>
</ul>
</li>
<li>TLS握手（HTTPS）：如果是HTTPS，还需进行TLS握手<ul>
<li>服务器证书检查</li>
<li>密钥交换</li>
<li>建立加密通信隧道</li>
</ul>
</li>
<li>发送HTTP请求：浏览器向服务器发送HTTP请求，包含请求方法、路径、头部信息等</li>
<li>服务器处理请求：服务器接收请求，进行相应处理，生成HTTP响应</li>
<li>接收HTTP响应：浏览器接收服务器返回的数据，包含状态码、响应头、响应体</li>
<li>解析HTML：浏览器开始解析HTML，构建DOM树</li>
<li>处理CSS：解析CSS，构建CSSOM树</li>
<li>执行JavaScript：加载并执行JavaScript代码</li>
<li>构建渲染树：将DOM树和CSSOM树结合，形成渲染树</li>
<li>布局：计算每个元素在屏幕上的精确位置和大小</li>
<li>绘制：将计算好的像素信息绘制到屏幕上</li>
<li>合成：将多个图层合成为最终显示的页面</li>
<li>TCP连接关闭：数据传输完成后，断开TCP连接（四次挥手）<ul>
<li>客户端发送FIN包，表示客户端不再发送数据</li>
<li>服务器发送ACK包，确认收到客户端的FIN</li>
<li>服务器发送FIN包，表示服务器也不再发送数据</li>
<li>客户端发送ACK包，确认收到服务器的FIN</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/03/01/SQL%E9%80%9F%E9%80%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/01/SQL%E9%80%9F%E9%80%9A/" class="post-title-link" itemprop="url">SQL速通</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-01 22:36:00" itemprop="dateCreated datePublished" datetime="2025-03-01T22:36:00+08:00">2025-03-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%BD%9C/" itemprop="url" rel="index"><span itemprop="name">工作</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">离职系列</span>
  <span class="sub-tag">第十三篇</span>
</div>

<div class="article-quote">
离职系列，回忆过去，在这做个记录。
</div>

<h1 id="SQL脚本管理规范：小团队高频发版实践指南"><a href="#SQL脚本管理规范：小团队高频发版实践指南" class="headerlink" title="SQL脚本管理规范：小团队高频发版实践指南"></a>SQL脚本管理规范：小团队高频发版实践指南</h1><h2 id="1-背景与目的"><a href="#1-背景与目的" class="headerlink" title="1. 背景与目的"></a>1. 背景与目的</h2><p>作为一个研发不到10人的团队，从0到1构建SAAS平台，且每周需要发布2-3个版本，所以总有些团队管理等问题会慢慢暴露，我们再慢慢修复，就跟修BUG一样，这一篇就是因为上线出过SQL脚本的问题（阿里云的SQL控制台对一些写的不太规范的sql执行存在兼容性问题会导致SQL执行不符合预期），所以有了这篇SQL规范，先说问题，当前SQL脚本管理存在以下问题：</p>
<ul>
<li>各开发人员风格不一，缺乏统一规范</li>
<li>脚本分散、无统一管理，难以追踪变更历史</li>
<li>发版频繁导致变更混乱，增加了维护成本</li>
<li>部分脚本质量不高，存在安全隐患</li>
</ul>
<p>本规范旨在提供一套简单、实用且专业的SQL脚本管理方案，帮助团队高效管理数据库变更，可根据实践情况持续优化。</p>
<h2 id="2-目录结构"><a href="#2-目录结构" class="headerlink" title="2. 目录结构"></a>2. 目录结构</h2><p>采用精简的目录结构，既能满足版本管理需求，又不过于复杂：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/PG                      # 数据库名称</span><br><span class="line">├── YYYY/                # 年份目录</span><br><span class="line">│   └── MM-DD/           # 日期目录，如04-15表示4月15日</span><br><span class="line">│       ├── release_N/   # 发布版本号，如release_1</span><br><span class="line">│       │   ├── DDL/     # 数据结构变更脚本</span><br><span class="line">│       │   │   ├── 001_create_table_xxx.sql</span><br><span class="line">│       │   │   └── 002_create_index_xxx.sql</span><br><span class="line">│       │   ├── DML/     # 数据操作脚本</span><br><span class="line">│       │   │   └── 001_add_data_xxx.sql</span><br><span class="line">│       │   └── ROLLBACK/ # 回滚脚本（可选）</span><br><span class="line">│       │       └── 001_rollback_xxx.sql</span><br><span class="line">├── dictionary/          # 数据字典</span><br><span class="line">│   ├── base/            # 基础数据</span><br><span class="line">│   │   ├── init_v1.0.sql  # 2025年1月版本</span><br><span class="line">│   │   └── init_v2.0.sql  # 2025年7月版本（整合上半年变更）</span><br><span class="line">│   ├── incremental/       # 按数据字典type</span><br><span class="line">│   │   ├── dict_payment_type.sql  </span><br><span class="line">│   │   └── ...</span><br><span class="line">├── menu/                # 菜单</span><br><span class="line">│   ├── base/    # 基础数据</span><br><span class="line">│   │   ├── init_v1.0.sql  # 2025年1月版本</span><br><span class="line">│   │   └── init_v2.0.sql  # 2025年7月版本（整合上半年变更）</span><br><span class="line">│   ├── ...</span><br><span class="line">│   ├── module_xx/       # 按模块</span><br><span class="line">│   │   ├── crm.sql </span><br><span class="line">│   │   └── ...     </span><br></pre></td></tr></table></figure>

<h2 id="3-文件命名规范"><a href="#3-文件命名规范" class="headerlink" title="3. 文件命名规范"></a>3. 文件命名规范</h2><h3 id="3-1-脚本文件命名"><a href="#3-1-脚本文件命名" class="headerlink" title="3.1 脚本文件命名"></a>3.1 脚本文件命名</h3><p>采用<code>序号_描述[_rollback].sql</code>格式：</p>
<ul>
<li><strong>序号</strong>：确保执行顺序，如<code>001</code>、<code>002</code></li>
<li><strong>描述</strong>：简明表达脚本用途，如<code>create_user_table</code>、<code>add_email_column</code></li>
<li><strong>rollback</strong>：回滚脚本添加<code>_rollback</code>后缀</li>
</ul>
<p>示例：</p>
<ul>
<li><code>001_create_user_table.sql</code></li>
<li><code>001_create_user_table_rollback.sql</code></li>
</ul>
<h3 id="3-2-数据库对象命名"><a href="#3-2-数据库对象命名" class="headerlink" title="3.2 数据库对象命名"></a>3.2 数据库对象命名</h3><ol>
<li><p><strong>表命名</strong>：</p>
<ul>
<li>使用小写和下划线</li>
<li>采用前缀区分业务模块，如<code>sys_user</code>、<code>order_item</code></li>
<li>名称应能清晰表达表的用途</li>
</ul>
</li>
<li><p><strong>列命名</strong>：</p>
<ul>
<li>主键统一为<code>id</code></li>
<li>外键使用<code>entity_id</code>格式，如<code>user_id</code></li>
<li>创建和更新时间统一为<code>create_time</code>、<code>update_time</code></li>
</ul>
</li>
<li><p><strong>索引命名</strong>：</p>
<ul>
<li>主键索引：<code>pk_表名</code></li>
<li>唯一索引：<code>uk_表名_列名</code></li>
<li>普通索引：<code>idx_表名_列名</code></li>
</ul>
</li>
</ol>
<h2 id="4-脚本编写规范"><a href="#4-脚本编写规范" class="headerlink" title="4. 脚本编写规范"></a>4. 脚本编写规范</h2><h3 id="4-1-文件头注释"><a href="#4-1-文件头注释" class="headerlink" title="4.1 文件头注释"></a>4.1 文件头注释</h3><p>所有SQL脚本必须包含统一的文件头注释：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ========================================</span></span><br><span class="line"><span class="comment">-- 描述: [功能简述]</span></span><br><span class="line"><span class="comment">-- 文件名: [文件名]</span></span><br><span class="line"><span class="comment">-- 作者: [作者]</span></span><br><span class="line"><span class="comment">-- 创建日期: [YYYY-MM-DD]</span></span><br><span class="line"><span class="comment">-- ========================================</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-SQL编写原则"><a href="#4-2-SQL编写原则" class="headerlink" title="4.2 SQL编写原则"></a>4.2 SQL编写原则</h3><ol>
<li><p><strong>原子性</strong>：一个脚本只完成一个独立任务</p>
</li>
<li><p><strong>幂等性</strong>：脚本可以重复执行而不产生副作用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 好的做法</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> users (</span><br><span class="line">  id <span class="type">VARCHAR</span>(<span class="number">36</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> users;</span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">  id <span class="type">VARCHAR</span>(<span class="number">36</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>向后兼容</strong>：尽量避免破坏性变更</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不允许</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>安全性</strong>：敏感信息不应明文存储</p>
</li>
</ol>
<h3 id="4-3-代码风格"><a href="#4-3-代码风格" class="headerlink" title="4.3 代码风格"></a>4.3 代码风格</h3><ol>
<li><p><strong>关键字大写</strong>：所有SQL关键字使用大写形式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>适当缩进</strong>：使用一致的缩进提高可读性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    u.id,</span><br><span class="line">    u.username,</span><br><span class="line">    r.name <span class="keyword">AS</span> role_name</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">    users u</span><br><span class="line"><span class="keyword">JOIN</span> </span><br><span class="line">    roles r <span class="keyword">ON</span> u.role_id <span class="operator">=</span> r.id</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">    u.status <span class="operator">=</span> <span class="string">&#x27;active&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加注释</strong>：为复杂SQL语句添加适当注释</p>
</li>
</ol>
<h2 id="5-特殊脚本管理"><a href="#5-特殊脚本管理" class="headerlink" title="5. 特殊脚本管理"></a>5. 特殊脚本管理</h2>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">数据字典和菜单：</span><br><span class="line"></span><br><span class="line">├── dictionary/          # 数据字典</span><br><span class="line">│   ├── base/            # 基础数据</span><br><span class="line">│   │   ├── init_v1.0.sql  # 2025年1月版本</span><br><span class="line">│   │   └── init_v2.0.sql  # 2025年7月版本（整合上半年变更）</span><br><span class="line">│   ├── incremental/       # 按数据字典type</span><br><span class="line">│   │   ├── dict_payment_type.sql  </span><br><span class="line">│   │   └── ...</span><br><span class="line">├── menu/                # 菜单</span><br><span class="line">│   ├── base/    # 基础数据</span><br><span class="line">│   │   ├── init_v1.0.sql  # 2025年1月版本</span><br><span class="line">│   │   └── init_v2.0.sql  # 2025年7月版本（整合上半年变更）</span><br><span class="line">│   ├── ...</span><br><span class="line">│   ├── module_xx/       # 按模块</span><br><span class="line">│   │   ├── crm.sql </span><br><span class="line">│   │   └── ...    </span><br></pre></td></tr></table></figure>

<h2 id="6-实施流程"><a href="#6-实施流程" class="headerlink" title="6. 实施流程"></a>6. 实施流程</h2><p>针对高频发版小团队，简化流程但不降低质量要求：</p>
<h3 id="6-1-开发变更流程"><a href="#6-1-开发变更流程" class="headerlink" title="6.1 开发变更流程"></a>6.1 开发变更流程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[编写SQL脚本] --&gt; B[本地测试]</span><br><span class="line">    B --&gt; C&#123;通过?&#125;</span><br><span class="line">    C --&gt;|否| A</span><br><span class="line">    C --&gt;|是| D[通知焕涛]</span><br><span class="line">    D --&gt; E[代码评审]</span><br><span class="line">    E --&gt; F&#123;焕涛通过云平台工具测试执行通过?&#125;</span><br><span class="line">    F --&gt;|否| A</span><br><span class="line">    F --&gt;|是| G[测试环境部署]</span><br><span class="line">    G --&gt; H&#123;测试人员验证通过?&#125;</span><br><span class="line">    H --&gt;|否| A</span><br><span class="line">    H --&gt;|是| I[生产环境部署]</span><br></pre></td></tr></table></figure>

<h3 id="6-2执行顺序"><a href="#6-2执行顺序" class="headerlink" title="6.2执行顺序"></a>6.2执行顺序</h3><p>为确保数据库变更的安全有序，按以下顺序执行：</p>
<ol>
<li>DDL脚本（按文件名序号顺序）</li>
<li>DML脚本（按文件名序号顺序）</li>
<li>特殊配置（数据字典、菜单）</li>
</ol>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>团队应当将本规范视为基础标准，在实践中不断完善和优化，形成最适合团队的工作方式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/02/22/%E5%B7%A5%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/02/22/%E5%B7%A5%E4%BD%9C/" class="post-title-link" itemprop="url">Java开发工程师、全栈开发工程师</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-02-22 19:31:46" itemprop="dateCreated datePublished" datetime="2025-02-22T19:31:46+08:00">2025-02-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Java开发工程师、全栈开发工程师"><a href="#Java开发工程师、全栈开发工程师" class="headerlink" title="Java开发工程师、全栈开发工程师"></a>Java开发工程师、全栈开发工程师</h3><p>亲爱的招聘团队：</p>
<p>如果软件工程师是一道菜，那我就是那种经过12年慢火熬制的老汤底——看起来平淡无奇，但一尝就知道功夫在里头。</p>
<p>我的技术栈就像一个资深玩家的技能树：主技能点满了Java和React，副技能解锁了Vue、Docker、Python和Go等。在我的职业旅程中，我善于将复杂问题分解为简单模块，轻松应对各种技术挑战。但我最厉害的外挂其实是曾经当过产品助理——这让我不仅能听懂产品经理说的”简单调整”背后隐藏的36个子需求，还能在技术与业务之间自如翻译，堪称”产品语言通”。</p>
<p>在我的12年职业生涯中，我从”这bug在本地没问题啊”进化到了”这需求有啥实际意义”再到”好的，我来搞定！”。带团队的经历让我明白，比起Debug代码，Debug人际关系才是真正的高难度挑战。所幸，我在这两方面都交出了不错的成绩单。</p>
<p>相信我的技术能力、产品思维和团队协作经验能为您的团队带来实质性的贡献。代码之外，我能够搭建开发者与产品、业务之间的桥梁，确保我们不只是在开发功能，而是在创造价值。我们一定能擦出技术的火花——毕竟，一个能理解产品、带过团队、写了12年代码还没秃顶的工程师，不是每天都能遇到的。</p>
<p>代码问候，<br>[软件开发特种兵]</p>
<p>联系方式：<br>电话：[18515068121]<br>邮箱：[<a href="mailto:&#103;&#97;&#109;&#x65;&#x68;&#x75;&#x40;&#121;&#x65;&#97;&#104;&#x2e;&#x6e;&#x65;&#x74;">&#103;&#97;&#109;&#x65;&#x68;&#x75;&#x40;&#121;&#x65;&#97;&#104;&#x2e;&#x6e;&#x65;&#x74;</a>]<br>Wechat：[GamehuDB]</p>
<p>P.S. 我的GitHub贡献图可能不够绿，但我的生产环境代码从不让服务器变红。</p>
<h3 id="Java-Development-Engineer-x2F-Full-Stack-Development-Engineer"><a href="#Java-Development-Engineer-x2F-Full-Stack-Development-Engineer" class="headerlink" title="Java Development Engineer&#x2F;Full Stack Development Engineer"></a>Java Development Engineer&#x2F;Full Stack Development Engineer</h3><p>Dear Hiring Team:</p>
<p>If software engineers were dishes, I’d be that slow-simmered stock that’s been cooking for 12 years — looking unassuming, but one taste reveals the expertise within.</p>
<p>My tech stack resembles a veteran player’s skill tree: maxed-out primary skills in Java and React, with unlocked secondary abilities in Vue, Docker, Python, Go, and more. Throughout my professional journey, I’ve honed the ability to break complex problems into simple modules, easily tackling various technical challenges. But my most powerful perk comes from my experience as a product assistant — I can decode the 36 hidden sub-requirements behind a product manager’s “simple adjustment” and fluently translate between technical and business languages, making me a true “product whisperer.”</p>
<p>During my 12-year career, I’ve evolved from “but the bug doesn’t appear on my local machine” to “what’s the actual purpose of this requirement” to “I’ll handle it!” My team leadership experience taught me that debugging human relationships is far more challenging than debugging code. Fortunately, I’ve managed to achieve good results in both areas.</p>
<p>I believe my technical abilities, product mindset, and team collaboration experience will bring substantial value to your team. Beyond coding, I can build bridges between developers, product teams, and business units, ensuring we’re not just developing features but creating value. We’ll definitely create technical sparks together — after all, an engineer who understands products, has led teams, and has written code for 12 years without going bald isn’t someone you meet every day.</p>
<p>Code regards,<br>[Software Development Special Forces]</p>
<p>Contact Information:<br>twitter：[Gamehu520]<br>email：[<a href="mailto:&#x67;&#97;&#x6d;&#x65;&#x68;&#x75;&#x40;&#x79;&#101;&#97;&#104;&#46;&#110;&#x65;&#x74;">&#x67;&#97;&#x6d;&#x65;&#x68;&#x75;&#x40;&#x79;&#101;&#97;&#104;&#46;&#110;&#x65;&#x74;</a>]<br>Wechat：[GamehuDB]</p>
<p>P.S. My GitHub contribution graph might not be very green, but my production code never turns servers red.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2025/01/01/MCP%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/01/MCP%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">MCP协议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-01-01 21:57:02" itemprop="dateCreated datePublished" datetime="2025-01-01T21:57:02+08:00">2025-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="ai-tag">AI</span>
  <span class="sub-tag">第三篇</span>
</div>

<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>知道MCP还是源于因为之前验证<a href="/2024/12/23/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/" title="大模型集成">大模型集成</a>时了解到的。因为当时后续计划做AI应用，增加saas平台的噱头的同时成为一个亮点功能，提升用户体验。</p>
<h1 id="基础概念与架构设计"><a href="#基础概念与架构设计" class="headerlink" title="基础概念与架构设计"></a>基础概念与架构设计</h1><p>MCP(Model Context Protocol）是一个开放协议，它标准化了应用程序如何向大语言模型（LLMs）提供上下文。可以将MCP比作AI应用的USB-C接口。正如USB-C提供了一种标准化的方式，将你的设备连接到各种外围设备和配件，MCP 也提供了一种标准化的方式，将AI模型连接到不同的数据源和工具。</p>
<h2 id="一、协议本质解构"><a href="#一、协议本质解构" class="headerlink" title="一、协议本质解构"></a>一、协议本质解构</h2><p>MCP是一种<strong>客户端-服务器架构的数据访问协议</strong>，专为AI应用（如大语言模型）设计，其核心是为AI应用提供一种标准化方式来安全访问多种数据源。</p>
<p><strong>关键组件</strong></p>
<ol>
<li>MCP 主机：运行AI应用并发起数据请求，如聊天应用或IDE</li>
<li>MCP 客户端：处理与 MCP 服务器的通信</li>
<li>MCP 服务器：连接到各种数据源的轻量级程序</li>
<li>大型语言模型(LLM)：分析问题并选择回答的 AI 模型</li>
<li>数据源：包括数据库、外部 API 等</li>
</ol>
<p>MCP采用简洁的JSON格式进行通信，主要支持两类基本操作：</p>
<ul>
<li><strong>发现操作</strong>：客户端识别服务器提供的能力</li>
<li><strong>执行操作</strong>：请求服务器执行特定工具来访问数据</li>
</ul>
<h2 id="二、核心作用剖析"><a href="#二、核心作用剖析" class="headerlink" title="二、核心作用剖析"></a>二、核心作用剖析</h2><ol>
<li><p><strong>访问标准化</strong></p>
<ul>
<li>为不同类型的数据源提供统一的访问接口</li>
<li>客户端无需了解每个数据源的具体访问细节</li>
</ul>
</li>
<li><p><strong>安全控制</strong></p>
<ul>
<li>服务器明确声明其访问能力和权限范围</li>
<li>支持基本的认证和授权机制</li>
<li>客户端可以限制服务器的访问范围</li>
</ul>
</li>
<li><p><strong>工具扩展性</strong></p>
<ul>
<li>服务器可以动态注册和提供各种工具</li>
<li>客户端可以发现并使用这些工具</li>
<li>支持从简单的文件读取到复杂的API调用等多种操作</li>
</ul>
</li>
</ol>
<h2 id="三、基本工作流程"><a href="#三、基本工作流程" class="headerlink" title="三、基本工作流程"></a>三、基本工作流程</h2><h3 id="MCP的典型工作流程如下：内部实现可能会有多次循环"><a href="#MCP的典型工作流程如下：内部实现可能会有多次循环" class="headerlink" title="MCP的典型工作流程如下：内部实现可能会有多次循环"></a>MCP的典型工作流程如下：内部实现可能会有多次循环</h3><p><img src="/2025/01/01/MCP%E5%8D%8F%E8%AE%AE/2.png" alt="alt text"><br>大体流程如下：</p>
<ol>
<li>用户向 MCP 主机（如聊天应用或 IDE）提出问题</li>
<li>主机将问题发送给大型语言模型(LLM)进行分析</li>
<li>LLM 确定需要使用哪些工具来回答问题</li>
<li>主机通过 MCP 客户端请求执行相应工具</li>
<li>MCP 客户端向不同的 MCP 服务器发送工具执行请求</li>
<li>MCP 服务器访问相应的数据源（数据库或外部 API）</li>
<li>数据源返回结果给 MCP 服务器，再传回客户端</li>
<li>MCP 客户端汇总工具执行结果并返回给主机</li>
<li>主机将工具结果发送给 LLM 生成最终回答</li>
<li>最终回答显示给用户</li>
</ol>
<h2 id="四、现实应用场景"><a href="#四、现实应用场景" class="headerlink" title="四、现实应用场景"></a>四、现实应用场景</h2><p>MCP适用于以下典型场景：</p>
<ol>
<li><p><strong>增强型AI聊天应用</strong></p>
<ul>
<li>让聊天机器人能够访问用户本地文件和数据库</li>
<li>使AI可以获取并引用真实、最新的信息</li>
</ul>
</li>
<li><p><strong>智能开发工具</strong></p>
<ul>
<li>IDE中的代码助手可以访问项目代码文件</li>
<li>辅助工具可以查询API文档和相关资源</li>
</ul>
</li>
<li><p><strong>企业AI集成</strong></p>
<ul>
<li>让AI应用安全地访问企业内部数据</li>
<li>在保护敏感信息的同时提供个性化服务</li>
</ul>
</li>
</ol>
<h2 id="五、协议现状与局限"><a href="#五、协议现状与局限" class="headerlink" title="五、协议现状与局限"></a>五、协议现状与局限</h2><p>当前MCP协议的特点与局限：</p>
<ol>
<li><p><strong>简洁性优先</strong></p>
<ul>
<li>协议设计相对简单，专注于解决基本的数据访问问题</li>
<li>尚未包含复杂的加密、动态路由等高级功能</li>
</ul>
</li>
<li><p><strong>开发阶段</strong></p>
<ul>
<li>协议仍在发展中，标准可能会随时间演进</li>
<li>生态系统正在逐步构建</li>
</ul>
</li>
<li><p><strong>基础功能聚焦</strong></p>
<ul>
<li>当前主要聚焦于基础的数据访问能力</li>
<li>缺乏高级的事务处理、分布式一致性等特性</li>
</ul>
</li>
</ol>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>MCP代表了AI工具与数据源之间交互的一个重要标准化尝试。它为构建能够访问和利用各种数据的AI应用提供了基础架构，虽然相对简单，但解决了AI应用难以安全访问多样化数据的关键问题。随着协议的发展，MCP有潜力成为AI应用与数据源之间交互的重要标准，类似于HTTP对于web应用的意义。</p>
<p>但是目前MCP仍处于相对早期阶段，其真正的潜力和影响力将随着更多实现和应用的出现而逐步显现。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.anthropic.com/news/model-context-protocol">https://www.anthropic.com/news/model-context-protocol</a><br><a target="_blank" rel="noopener" href="https://github.com/modelcontextprotocol">https://github.com/modelcontextprotocol</a><br><a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/introduction">https://modelcontextprotocol.io/introduction</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=sahuZMMXNpI">https://www.youtube.com/watch?v=sahuZMMXNpI</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=eur8dUO9mvE">https://www.youtube.com/watch?v=eur8dUO9mvE</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=kQmXtrmQ5Zg&t=2s">https://www.youtube.com/watch?v=kQmXtrmQ5Zg&amp;t=2s</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2024/12/29/resume/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/29/resume/" class="post-title-link" itemprop="url">简历模板</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-29 22:19:00" itemprop="dateCreated datePublished" datetime="2024-12-29T22:19:00+08:00">2024-12-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AA%E4%BA%BA/" itemprop="url" rel="index"><span itemprop="name">个人</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">离职系列</span>
  <span class="sub-tag">第N篇</span>
</div>
<div class="article-quote">
离职前一天，想想简历咋写，弄个排版出来，后续好造着整理下简历。纯属个人意见。我先自己试试，不好用再改。
</div>

<h2 id="我的观点"><a href="#我的观点" class="headerlink" title="我的观点"></a>我的观点</h2><p>我觉得简历的本质是为了筛选而不是为了深入了解你。所以我认为简历：</p>
<ol>
<li>首先得清爽。</li>
<li>然后得简明扼要。</li>
</ol>
<p>不用写太多同时又能体现关键信息，就跟咱们做程序一样，设计时重点之一就是数据得便于各场景使用，便于使用很大的一个方面就是数据能各种过滤和组合，通常是现有简明的入口，如果要了解细节就得下钻，可能是一层或多层才能看透数据。那简历就像入口，如果对方有兴趣才会下钻，所以不应该想着一个简历就把自己交代的底裤都没有，一方面是内容太多不容易抓到重点，另一方面是太细了搞得人都没欲望深入探讨，咋约你面试呢？</p>
<p>所以简历得像咱们对待产品需求一样，你得解决需求场景同时兼顾一些扩展性。抽象出来一个模板适配通用场景，然后可根据具体特殊场景，再保证真实的前提下做一些微调，对其JD中的要求。</p>
<hr>

<h1 id="抽象了一个通用模板如下："><a href="#抽象了一个通用模板如下：" class="headerlink" title="抽象了一个通用模板如下："></a><span style='color:red;'>抽象了一个通用模板如下：</span></h1><h2 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h2><ul>
<li>求职意向：技术负责人&#x2F;技术专家</li>
<li>工作年限：8年+</li>
<li>学历：xx</li>
<li>电话：xx</li>
<li>期望薪资：xx</li>
</ul>
<h2 id="专业技能"><a href="#专业技能" class="headerlink" title="专业技能"></a>专业技能</h2><h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><ul>
<li>后端：Java、Spring Boot、Spring Cloud、MySQL、Redis、消息队列</li>
<li>前端：React、TypeScript、Ant Design、Redux、Webpack</li>
<li>DevOps：Docker、Jenkins、Git、Jira</li>
<li>架构：微服务架构、前后端分离、分布式系统设计</li>
</ul>
<h3 id="管理能力"><a href="#管理能力" class="headerlink" title="管理能力"></a>管理能力</h3><ul>
<li>团队管理：带领3-6人团队，完成项目全周期开发</li>
<li>技术规划：制定技术方案，把控技术方向，推动技术创新</li>
<li>敏捷实践：推行敏捷开发，提升团队效能</li>
<li>人才培养：建立技术培训体系，提升团队技术能力</li>
</ul>
<h2 id="工作经历"><a href="#工作经历" class="headerlink" title="工作经历"></a>工作经历</h2><h3 id="XX公司（2021-至今）"><a href="#XX公司（2021-至今）" class="headerlink" title="XX公司（2021-至今）"></a>XX公司（2021-至今）</h3><p>职位：技术负责人</p>
<p>负责工作：</p>
<ol>
<li><p>带领5-6人团队完成大型LLM应用平台开发，实现从0到1</p>
<ul>
<li>设计并实现基于微服务架构的系统框架</li>
<li>优化系统性能，提升用户体验</li>
<li>建立代码规范和技术文档体系</li>
<li>系统月活用户达到10w+，支持高并发访问</li>
</ul>
</li>
<li><p>技术架构升级与优化</p>
<ul>
<li>推动系统微服务化改造，提升系统可扩展性</li>
<li>实现核心模块性能优化，接口响应时间提升50%</li>
<li>建立监控告警体系，提高系统稳定性</li>
</ul>
</li>
</ol>
<h3 id="XX公司（2019-2021）"><a href="#XX公司（2019-2021）" class="headerlink" title="XX公司（2019-2021）"></a>XX公司（2019-2021）</h3><p>职位：Web前端负责人</p>
<p>负责工作：</p>
<ol>
<li><p>带领3-4人前端团队完成企业级SaaS平台开发</p>
<ul>
<li>基于React技术栈搭建前端框架</li>
<li>实现组件库设计与开发</li>
<li>推动前端工程化建设</li>
<li>平台服务企业客户100+</li>
</ul>
</li>
<li><p>技术改进与创新</p>
<ul>
<li>建立前端性能监控体系</li>
<li>推动前端自动化测试实践</li>
<li>优化构建流程，部署时间缩短60%<br>…</li>
</ul>
</li>
</ol>
<h2 id="项目经验"><a href="#项目经验" class="headerlink" title="项目经验"></a>项目经验</h2><h3 id="xx平台（2022-2023）"><a href="#xx平台（2022-2023）" class="headerlink" title="xx平台（2022-2023）"></a>xx平台（2022-2023）</h3><ul>
<li>项目规模：5-6人团队，服务10w+用户</li>
<li>技术架构：Spring Cloud + React + MySQL + Redis</li>
<li>主要职责：<ul>
<li>负责整体技术方案设计</li>
<li>核心功能开发与性能优化</li>
<li>带领团队完成开发任务</li>
</ul>
</li>
<li>项目成就：<ul>
<li>系统支持高并发访问，峰值QPS 5000+</li>
<li>用户响应时间&lt;500ms</li>
<li>系统可用性达99.9%</li>
</ul>
</li>
</ul>
<h3 id="xx企业级SaaS平台（2019-2021）"><a href="#xx企业级SaaS平台（2019-2021）" class="headerlink" title="xx企业级SaaS平台（2019-2021）"></a>xx企业级SaaS平台（2019-2021）</h3><ul>
<li>项目规模：前端3-4人团队</li>
<li>技术架构：React + TypeScript + Ant Design</li>
<li>主要职责：<ul>
<li>前端架构设计与实现</li>
<li>团队管理与技术指导</li>
<li>核心功能开发</li>
</ul>
</li>
<li>项目成就：<ul>
<li>平台月活用户5w+</li>
<li>前端性能提升40%</li>
<li>客户满意度95%+</li>
</ul>
</li>
</ul>
<h2 id="教育背景"><a href="#教育背景" class="headerlink" title="教育背景"></a>教育背景</h2><ul>
<li>XX大学 计算机科学与技术 本科</li>
</ul>
<h2 id="个人评价"><a href="#个人评价" class="headerlink" title="个人评价"></a>个人评价</h2><ul>
<li>扎实的技术功底，丰富的项目经验</li>
<li>优秀的团队管理能力和沟通协调能力</li>
<li>具备较强的技术视野和架构设计能力</li>
<li>持续学习，保持对新技术的敏感度</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2024/12/23/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/23/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/" class="post-title-link" itemprop="url">大模型集成</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-23 23:41:00" itemprop="dateCreated datePublished" datetime="2024-12-23T23:41:00+08:00">2024-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">离职系列</span>
  <span class="sub-tag">第十二篇</span>
</div>
<div class="article-quote">
离职系列，想想这几年在公司的成长，在这做个记录。这篇是关于AI功能方案验证。
</div>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>落地事业部上一年关于AI的创新奖的方案，更合适的叫法应该是交接，之前的团队几乎停留在理论上和一个demo上，因为久久没有效果，可能感受到了上级的压力，需要看到实际效果，最终找到了我们团队，希望能借助我们团队让其产生价值（官方说法），我理解实际就接这个摊子。好在年前我自己捣鼓过AI知识库<a href="/2024/03/12/AI%E5%BA%94%E7%94%A8-%E7%9F%A5%E8%AF%86%E5%BA%93/" title="AI应用-知识库">AI应用-知识库</a>，所以不怯场。</p>
<h2 id="方案介绍"><a href="#方案介绍" class="headerlink" title="方案介绍"></a>方案介绍</h2><p>因为在这之前就是一个demo，具体前面的团队也说不出来个所以然，所以我们直接说说两边对话后的方案走向，希望做一个功能：容量预测，意思是根据服务器的多个指标历史数据，预估服务器未来的负载情况，从而给予客户参考或预案。</p>
<p>我试着画下大体的方案：</p>
<h3 id="架构图："><a href="#架构图：" class="headerlink" title="架构图："></a>架构图：</h3><p><img src="/2024/12/23/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/ai01.png" alt="alt text"></p>
<h3 id="时序图："><a href="#时序图：" class="headerlink" title="时序图："></a>时序图：</h3><p><img src="/2024/12/23/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%9B%86%E6%88%90/ai02.png" alt="alt text"></p>
<h3 id="大体流程"><a href="#大体流程" class="headerlink" title="大体流程"></a>大体流程</h3><ol>
<li>调度器触发flink批任务从ClickHouse获取原始数据</li>
<li>Flink进行基本的数据清洗和标准化</li>
<li>处理后的数据存入CK</li>
<li>python预测模型从CK获取数据</li>
<li>预测模型生成预测结果</li>
<li>阈值分析器识别潜在瓶颈</li>
<li>python大模型提供深度解释和建议</li>
<li>生成预测报告和告警</li>
</ol>
<h3 id="学习链接"><a href="#学习链接" class="headerlink" title="学习链接"></a>学习链接</h3><h4 id="ollama"><a href="#ollama" class="headerlink" title="ollama"></a>ollama</h4><p>ollama is an open-source tool that simplifies running large language models locally on your personal computer<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=GWB9ApTPTv4&t=171s">https://www.youtube.com/watch?v=GWB9ApTPTv4&amp;t=171s</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2024/12/22/%E9%81%87%E8%A7%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/22/%E9%81%87%E8%A7%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">遇见多表查询</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-22 19:32:09" itemprop="dateCreated datePublished" datetime="2024-12-22T19:32:09+08:00">2024-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">离职系列</span>
  <span class="sub-tag">第十一篇</span>
</div>
<div class="article-quote">
离职系列，想想这几年在公司的成长，在这做个记录。这篇是关于维护的一个旧功能“全部告警跟踪”。
</div>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>每个租户有自己的告警数据，少则几千多则几十万条数据，云平台提供了一个功能叫“全部告警跟踪”，该功能顾名思义，会展示所有租户的所有告警信息(刷新那一刻是实时的)，还能支持过滤、搜索等操作，这功能据说上线没多久就有问题，比如点分页时不时会出现超时。但是因为这功能用的人非常少，且只有管理员才有权限，也就一直放着。<br>但是新版需求要求解决这个问题，因为现在是我维护这个功能，所以需要我先出个技术方案。</p>
<h2 id="解法设计输出模板"><a href="#解法设计输出模板" class="headerlink" title="解法设计输出模板"></a>解法设计输出模板</h2><ol>
<li><p>解法设计的模板很多，但是我感觉稍微有点重，当前产品的节奏，没有那么多的时间和人力给我做那么详细的解法设计，所以简单梳理了一个简化版的解法设计，并与干系人达成了一致。</p>
</li>
<li><p>模板如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 引言</span><br><span class="line">  - 背景说明</span><br><span class="line">  - 问题陈述(现状、目标)</span><br><span class="line">  - 关键术语</span><br><span class="line">  - 参考资料</span><br><span class="line"></span><br><span class="line">2. 需求分析</span><br><span class="line">  - 核心诉求/期望交付的价值</span><br><span class="line">  - 非功要求</span><br><span class="line">3. 约束条件</span><br><span class="line">  - 依赖项</span><br><span class="line">  - 假设项</span><br><span class="line"></span><br><span class="line">4. 方案设计</span><br><span class="line">  - 可选方案对比(2-3个)</span><br><span class="line">    * 方案描述</span><br><span class="line">    * 优缺点分析</span><br><span class="line">    * 非功表现</span><br><span class="line">  - 推荐方案详细说明</span><br><span class="line">    * 架构设计</span><br><span class="line">    * 核心流程</span><br><span class="line">    * 关键设计点、算法伪代码（如果有必要）</span><br><span class="line">  </span><br><span class="line">5. 实施评估(因为团队自己做实施，所以加上这一章)</span><br><span class="line">  - 影响范围</span><br><span class="line">  - 实施成本</span><br><span class="line">  - 后续影响</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>要分清楚解法设计和详细设计的核心区别：</p>
<ol>
<li>解法设计：回答”用什么方案解决问题”<ul>
<li>关注整体思路</li>
<li>多个方案对比选择</li>
<li>架构层面决策</li>
</ul>
</li>
<li>详细设计：回答”如何具体实现这个方案”<ul>
<li>已选定方案的具体技术实现细节</li>
<li>编码层面设计</li>
<li>…</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>在这儿我就不原方不动的把整个解法贴出来了，只捡几个重点说。</p>
<h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>一定要记住，虽然咱们是干技术的，但是做解法的时候，一定先不要直接从技术的角度思考，先从业务的角度，还原业务场景，以及可能的演进需求，做到扩展性。</p>
<ol>
<li>年少不懂事的时候，干过一段时间的产品助理，当时就学会做需求分析的几把斧：<blockquote>
<p>tips:</p>
<ol>
<li>搞清楚买单的人和使用的人谁？分别想解决什么问题，特别是买单的人容易被忽视。（使用方再满意，买单的人不满意也是白搭）</li>
<li>维护好与需求调研对象的关系（人情世故）</li>
<li>5W1H方法做需求分析和挖掘（找出底层需求，避免浮于表面文字）</li>
<li>KANO方法对需求分级（找出痛点先解决，其它的都是锦上添花）</li>
</ol>
</blockquote>
</li>
</ol>
<p>这儿的原始需求是管理员能对所有租户的告警跟踪查看，关注其下团队成员所负责的租户的处理情况，对工作进度有了解，同时可以随时查看核心客户的数据。<br>这样几句简单的话，应用5W1H+KANO拆解下：</p>
<ol>
<li><p>5W1H分析：</p>
<ol>
<li><p>WHO（谁）</p>
<ul>
<li>主体：管理员</li>
<li>关注对象：团队成员、租户</li>
</ul>
</li>
<li><p>WHAT（什么）</p>
<ul>
<li>查看所有租户的告警跟踪情况</li>
<li>了解团队成员的工作进度</li>
<li>查看核心客户数据</li>
</ul>
</li>
<li><p>WHEN（什么时候）</p>
<ul>
<li>随时（需要实时或准实时的数据）</li>
<li>告警发生后的跟踪过程中</li>
</ul>
</li>
<li><p>WHERE（在哪里）</p>
<ul>
<li>系统内</li>
</ul>
</li>
<li><p>WHY（为什么），更深入可以加入5Why方法，探寻源需求。</p>
<ul>
<li>监督团队工作情况</li>
<li>及时了解核心客户状况</li>
<li>确保告警得到及时处理</li>
</ul>
</li>
</ol>
</li>
<li><p>HOW（怎么做）</p>
<ul>
<li>提供告警跟踪查看、筛选功能</li>
<li>展示团队成员负责的租户处理进度</li>
<li>支持核心客户数据快速查看</li>
</ul>
</li>
<li><p>KANO模型分析：</p>
<ol>
<li><p>基本型需求（Must-be）：</p>
<ul>
<li>查看所有租户的告警记录</li>
<li>查看告警处理状态</li>
</ul>
</li>
<li><p>期望型需求（Performance）：</p>
<ul>
<li>团队成员工作进度追踪</li>
<li>核心客户数据查看</li>
</ul>
</li>
<li><p>兴奋型需求（Delighter）：</p>
<ul>
<li>数据分析和统计</li>
</ul>
</li>
</ol>
</li>
</ol>
<p><strong>这里能得到几个关键信息：</strong></p>
<ol>
<li>依然需要在活的实时的数据（需求已经明确）</li>
<li>需要搜索、分页、筛选（大数据量的场景）</li>
<li>后续很有可能需要统计数据（要考虑数据聚合）</li>
<li>非功<ol>
<li>1000+租户，每个租户50w的告警，10s内刷出数据。</li>
<li>经费有限，且重新申请流程慢，额度小。</li>
</ol>
</li>
</ol>
<h4 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h4><ol>
<li>方案1：ShardingSphere 自身实现。<br>广播表是ShardingSphere中的一个概念，指的是在所有分片中存在的表，每个分片都有完整的副本。当更新广播表时，所有分片都会同步更新。通常用于数据量不大且需要频繁关联查询的表，比如字典表。<ol>
<li>优点：简单，不用引入任何其他组件。</li>
<li>缺点：<ol>
<li>数据量太大，无法在每个分片都复制全量数据。</li>
</ol>
</li>
</ol>
</li>
<li>方案2：ClickHouse(开源版)+Flink CDC<ol>
<li>优点：<ol>
<li>CK在已在多个产品运用，学习成本较低。</li>
<li>可以支持复杂的查询、聚合需求。</li>
<li>适合离线分析。</li>
<li>单表查询性能极强。</li>
</ol>
</li>
<li>缺点：<ol>
<li>不支持事务。</li>
<li>集群部署成本高（官方没有提供Helm Chart。且ClickHouse集群扩展不方便，很多手动处理，不适合弹性扩展，集成k8s较难）。</li>
<li>删除&#x2F;更新性能差，更适合批量追加。告警数据会经常变更，可能存在性能问题。</li>
<li>手动管理分片、分区、MergeTree等，维护成本较高。</li>
</ol>
</li>
</ol>
</li>
<li>方案3：Doris+Flink CDC<ol>
<li><p>优点：</p>
<ol>
<li>实时性高、支持高并发。</li>
<li>可以支持复杂的查询需求、聚合需求。</li>
<li>集群部署成本低（Doris，官方提供了Helm Chart，且适合弹性扩展，运维压力小）。</li>
<li>自动话程度高（分片、负载均衡、存储管理等）</li>
<li>SQL友好</li>
<li>存算分离</li>
</ol>
</li>
<li><p>缺点：</p>
<ol>
<li>引入Doris新组件，可能会增加采购成本。</li>
<li>复杂的模糊搜索可能无法实现。</li>
</ol>
</li>
</ol>
</li>
<li>方案4：ES+Flink CDC<ol>
<li><p>优点：</p>
<ol>
<li>近实时，可能有秒级延迟。</li>
<li>可以支持复杂的查询需求（特别是全文检索）。</li>
<li>集群部署成本低（官方有Helm Chart和Operator，且适合弹性扩展，可无缝集成k8s，运维压力小）</li>
</ol>
</li>
<li><p>缺点：</p>
<ol>
<li>不支持事务</li>
<li>引入ES新组件，可能会增加较大采购成本（ES需要较多内存和SSD磁盘）。</li>
<li>很多时候需要手动处理，比如分片分步、设计索引、索引优化、GC 调优等，维护成本较高。</li>
<li>使用DSL，不是标准 SQL，学习成本较高。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="推荐方案2"><a href="#推荐方案2" class="headerlink" title="推荐方案2"></a>推荐方案2</h4><p>原因：</p>
<ol>
<li>在活告警数据量可控，暂不考虑扩展。</li>
<li>系统已接入了CK，最低成本（学习、部署、购买）。</li>
</ol>
<h5 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h5><p><img src="/2024/12/22/%E9%81%87%E8%A7%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/5.jpg" alt="alt text"></p>
<h5 id="关键验证点"><a href="#关键验证点" class="headerlink" title="关键验证点"></a>关键验证点</h5><p>1、2验证点，由于前期已经做过验证，着重验证3、4就行，特别是更新和删除数据。</p>
<h5 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h5><p>按500个租户，每个租户5000在活告警，没问题，因为主要是验证可行性，没有那么严格的压测，图啥的当时就没留了。这块详设的时候会更具体严格一些。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://www.gamehu.run/2024/09/26/%E9%81%87%E8%A7%81%E6%B4%AA%E5%B3%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_4038.jpeg">
      <meta itemprop="name" content="Gamehu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="10年经验Java开发者，精通React，熟悉Python、Docker、Vue及Go">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 正儿八经 - 资深Java/React工程师">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/26/%E9%81%87%E8%A7%81%E6%B4%AA%E5%B3%B0/" class="post-title-link" itemprop="url">遇见小洪峰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-26 22:00:11" itemprop="dateCreated datePublished" datetime="2024-09-26T22:00:11+08:00">2024-09-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="tag-container">
  <span class="main-tag">离职系列</span>
  <span class="sub-tag">第十篇</span>
</div>
<div class="article-quote">
离职系列，想想这几年在公司的成长，在这做个记录。这篇是关于线上的bug。
</div>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>其实说来这个问题，跟之前的<a href="/2024/09/17/%E9%81%87%E8%A7%81%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6/" title="遇见连接超时">遇见连接超时</a>有个遗留项也有一些关系，因为报错的源头，也是是数据库连接关闭，与上一次仅仅是我那块出问题不同的是，这次是大批量的租户多种任务都失败，飞书告警消息都把我弹麻了。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2024-10-23 17:00:10,177 [XxxGenerator8] ERROR [c.r.r.m.s.s.notice.impl.Xxx] Xxx.java:631 - 客户:2xx319,告警数据处理异常</span><br><span class="line">org.springframework.jdbc.UncategorizedSQLException: </span><br><span class="line">2024-10-23 17:00:10,176 [XxxGenerator8] ERROR [c.r.r.m.s.s.notice.impl.Xxx] Xxx.java:511 - 客户:2xx319,集成平台巡检数据处理异常</span><br><span class="line">024-10-23 17:00:10,175 [XxxGenerator8] ERROR [c.r.r.m.s.s.notice.impl.Xxx] Xxx.java:547 - 客户:2xx319,服务状态数据处理异常</span><br><span class="line">org.springframework.jdbc.UncategorizedSQLException: </span><br><span class="line">	... 35 common frames omitted</span><br><span class="line">2024-10-23 17:00:10,174 [XxxGenerator8] ERROR [c.r.r.m.s.s.notice.impl.Xxx] Xxx.java:582 - 客户:2xx319,心跳数据处理异常</span><br><span class="line">	... 82 common frames omitted</span><br><span class="line">org.springframework.jdbc.UncategorizedSQLException: </span><br><span class="line">     ### Cause: java.sql.SQLException: Connection is closed</span><br><span class="line">            ; uncategorized SQLException; SQL state [null]; error code [0]; Connection is closed</span><br><span class="line">              at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:93)</span><br><span class="line">              at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:439)</span><br><span class="line">              at java.base/java.lang.Thread.run(Thread.java:840)</span><br><span class="line">            Caused by: java.sql.SQLException: Connection is closed</span><br><span class="line"></span><br><span class="line">       </span><br></pre></td></tr></table></figure>

<p>这次定位很快，具体定位的就不再赘述，出了问题后，我想了想有两个明确的因素：</p>
<ol>
<li>上次类似的错误就发现了，连接池设置存在问题。<ol>
<li>再次检查，当前没有慢sql，所以初步判断是连接池问题。</li>
</ol>
</li>
<li>新上线了策略功能，策略把之前定时默认执行的任务，可更改为每个租户下每种类型单独的执行时间和周期。<ol>
<li>怀疑存在了N个客户N个任务都在同一时间点执行的问题，导致连接池耗尽。</li>
</ol>
</li>
</ol>
<h2 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h2><ol>
<li>根据预留的后门，手动把核心任务给生成了，让线上能正常处理。</li>
<li>因为之前已知了引入ShardingSphere后同时引入了HikariCP连接池，现在只留HikariCP连接池，并对参数进行调优。<ol>
<li>以下是同事调优后的参数：超时时间以及连接池大小都对应阿里云购买的高性能PG做了对应的调整。 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">master0:</span><br><span class="line">  dataSourceClassName: com.zaxxer.hikari.HikariDataSource</span><br><span class="line">  driverClassName: org.postgresql.Driver</span><br><span class="line">  jdbcUrl: jdbc:postgresql://xx.aliyuncs.com:xx/xx</span><br><span class="line">  username: xxx</span><br><span class="line">  password: xxx</span><br><span class="line">  connectionTimeout: 60000</span><br><span class="line">  idleTimeout: 600000</span><br><span class="line">  maxLifetime: 3600000</span><br><span class="line">  maximumPoolSize: 200</span><br><span class="line">  minimumIdle: 1</span><br><span class="line">  poolName: business-data-master0</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>临时的先让cron表达式有一定的偏移量比如<ol>
<li><pre><code>&#123;% codeblock %&#125;

               return timeList.stream()
                   .map(time -> &#123;
                       String[] timeParts = parseTime(time);
                       // TODO 临时解法：为每个cron添加随机偏移（ 0~3分钟）
                       int minuteOffset = ThreadLocalRandom.current().nextInt(4); // 生成 0~3 的随机数
                       int minute = (Integer.parseInt(timeParts[1]) + minuteOffset) % 60; // 防止超出 59 分钟
                       return "0 " + minute + " " + timeParts[0] + " * * ? ";
                   &#125;)
                   .collect(Collectors.toList());
                private static String[] parseTime(String time) &#123;
                    return time.split(":"); // 格式为 "HH:mm"
                &#125;
            &#125;

   &#123;% endcodeblock %&#125;
</code></pre>
</li>
</ol>
</li>
</ol>
<p>2、3做完之后，腾出缓冲时间着手长期解了，需要重新做下解法设计，以适配高并发的场景。</p>
<h2 id="解法设计1-0"><a href="#解法设计1-0" class="headerlink" title="解法设计1.0"></a>解法设计1.0</h2><p>具体的解法设计咋做，可看下之前的<a href="/2024/12/22/%E9%81%87%E8%A7%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2/" title="遇见多表查询">遇见多表查询</a>，这儿就直接给出一些结论：</p>
<ol>
<li>任务错峰（随机延迟）</li>
<li>任务限流（线程池 + 队列）</li>
<li>任务优先级机制（先执行核心任务）</li>
</ol>
<h3 id="UML："><a href="#UML：" class="headerlink" title="UML："></a>UML：</h3><p><img src="/2024/09/26/%E9%81%87%E8%A7%81%E6%B4%AA%E5%B3%B0/4.png" alt="alt text"></p>
<h3 id="流程图："><a href="#流程图：" class="headerlink" title="流程图："></a>流程图：</h3><p><img src="/2024/09/26/%E9%81%87%E8%A7%81%E6%B4%AA%E5%B3%B0/2.png" alt="alt text"></p>
<h3 id="时序图："><a href="#时序图：" class="headerlink" title="时序图："></a>时序图：</h3><p><img src="/2024/09/26/%E9%81%87%E8%A7%81%E6%B4%AA%E5%B3%B0/3.png" alt="alt text"></p>
<h3 id="关键伪代码"><a href="#关键伪代码" class="headerlink" title="关键伪代码"></a>关键伪代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// 任务优先级定义</span><br><span class="line">private enum TaskPriority &#123;</span><br><span class="line">    HIGH(0),</span><br><span class="line">    MEDIUM(5),</span><br><span class="line">    LOW(10);</span><br><span class="line"></span><br><span class="line">    private final int value;</span><br><span class="line"></span><br><span class="line">    TaskPriority(int value) &#123;</span><br><span class="line">        this.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getValue() &#123;</span><br><span class="line">        return value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* manage-biz Powerjob 调度类</span><br><span class="line">* 优化版本 - 任务削峰与队列管理</span><br><span class="line">*</span><br><span class="line">* @author hht</span><br><span class="line">* @since 2024-09-10</span><br><span class="line">*/</span><br><span class="line">@Component(value = &quot;manageBizPowerjobDispatcher&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">public class ManageBizPowerjobDispatcher &#123;</span><br><span class="line">    private final IXxxScheduleService XxxScheduleService;</span><br><span class="line">    private static final ObjectMapper OBJECT_MAPPER = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">    /** 平安通告powerjob任务id */</span><br><span class="line">    public static final String TASK_SAFETY_NOTICE_ID = &quot;generateXxx&quot;;</span><br><span class="line"></span><br><span class="line">    public static final String SUCCESS = &quot;success&quot;;</span><br><span class="line"></span><br><span class="line">    // 配置参数，可从配置文件注入</span><br><span class="line">    @Value(&quot;$&#123;powerjob.task.max-concurrent:10&#125;&quot;)</span><br><span class="line">    private int maxConcurrentTasks;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;powerjob.task.queue-capacity:500&#125;&quot;)</span><br><span class="line">    private int queueCapacity;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;powerjob.task.max-delay-minutes:5&#125;&quot;)</span><br><span class="line">    private int maxDelayMinutes;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;powerjob.task.worker-threads:20&#125;&quot;)</span><br><span class="line">    private int workerThreads;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // 延迟任务定义</span><br><span class="line">    @Data</span><br><span class="line">    private static class DelayedTask implements Delayed &#123;</span><br><span class="line">        private final Runnable task;</span><br><span class="line">        private final long executeTime;</span><br><span class="line">        private final String taskId;</span><br><span class="line">        private final String jobParams;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public long getDelay(TimeUnit unit) &#123;</span><br><span class="line">            return unit.convert(executeTime - System.currentTimeMillis(), TimeUnit.MILLISECONDS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 优先级任务定义</span><br><span class="line">    @Data</span><br><span class="line">    private static class PriorityTask implements Comparable&lt;PriorityTask&gt; &#123;</span><br><span class="line">        private final Runnable task;</span><br><span class="line">        private final TaskPriority priority;</span><br><span class="line">        private final String taskId;</span><br><span class="line">        private final String jobParams;</span><br><span class="line">        private final long createTime;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int compareTo(PriorityTask other) &#123;</span><br><span class="line">            // 先按优先级排序，再按创建时间排序</span><br><span class="line">            int priorityCompare = Integer.compare(priority.getValue(), other.priority.getValue());</span><br><span class="line">            if (priorityCompare != 0) &#123;</span><br><span class="line">                return priorityCompare;</span><br><span class="line">            &#125;</span><br><span class="line">            return Long.compare(createTime, other.createTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">      * 1.单独的线程，负责从队列中获取任务并分发</span><br><span class="line">      * 2.协调延迟队列和优先级队列</span><br><span class="line">      * 3.控制任务的并发执行数量</span><br><span class="line">     */</span><br><span class="line">    private class TaskDispatcher implements Runnable &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            while (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    // 先检查延迟队列</span><br><span class="line">                    DelayedTask delayedTask = delayedTaskQueue.poll();</span><br><span class="line">                    if (delayedTask != null) &#123;</span><br><span class="line">                        // 将任务添加到优先级队列</span><br><span class="line">                        submitToPriorityQueue(delayedTask.getTask(), TaskPriority.HIGH, delayedTask.getTaskId(), delayedTask.getJobParams());</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    // 从优先级队列取任务执行</span><br><span class="line">                    PriorityTask priorityTask = priorityTaskQueue.take();</span><br><span class="line">                    if (priorityTask != null) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            // 获取信号量，控制并发</span><br><span class="line">                            taskSemaphore.acquire();</span><br><span class="line">                            </span><br><span class="line">                            // 记录任务开始执行</span><br><span class="line">                            activeTaskCount.incrementAndGet();</span><br><span class="line">                            taskExecutionCount.computeIfAbsent(priorityTask.getTaskId(), k -&gt; new AtomicInteger(0)).incrementAndGet();</span><br><span class="line">                            </span><br><span class="line">                            // 提交到线程池执行</span><br><span class="line">                            executorService.submit(() -&gt; &#123;</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    log.info(&quot;执行任务: &#123;&#125;, 参数: &#123;&#125;&quot;, priorityTask.getTaskId(), priorityTask.getJobParams());</span><br><span class="line">                                    priorityTask.getTask().run();</span><br><span class="line">                                &#125; catch (Exception e) &#123;</span><br><span class="line">                                    log.error(&quot;任务执行异常: &#123;&#125;&quot;, priorityTask.getTaskId(), e);</span><br><span class="line">                                &#125; finally &#123;</span><br><span class="line">                                    // 释放信号量</span><br><span class="line">                                    taskSemaphore.release();</span><br><span class="line">                                    // 更新计数器</span><br><span class="line">                                    activeTaskCount.decrementAndGet();</span><br><span class="line">                                    AtomicInteger counter = taskExecutionCount.get(priorityTask.getTaskId());</span><br><span class="line">                                    if (counter != null) &#123;</span><br><span class="line">                                        counter.decrementAndGet();</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                            Thread.currentThread().interrupt();</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    break;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    log.error(&quot;任务分发器异常&quot;, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 任务队列和执行器</span><br><span class="line">    private DelayQueue&lt;DelayedTask&gt; delayedTaskQueue;</span><br><span class="line">    private PriorityBlockingQueue&lt;PriorityTask&gt; priorityTaskQueue;</span><br><span class="line">    private ExecutorService executorService;</span><br><span class="line">    private ExecutorService dispatcherService;</span><br><span class="line">    private Semaphore taskSemaphore;</span><br><span class="line">    private Random random;</span><br><span class="line"></span><br><span class="line">    // 任务执行状态监控</span><br><span class="line">    private AtomicLong totalTasksReceived = new AtomicLong(0);</span><br><span class="line">    private AtomicLong totalTasksExecuted = new AtomicLong(0);</span><br><span class="line">    private AtomicInteger activeTaskCount = new AtomicInteger(0);</span><br><span class="line">    private Map&lt;String, AtomicInteger&gt; taskExecutionCount = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() &#123;</span><br><span class="line">        // 初始化任务队列</span><br><span class="line">        delayedTaskQueue = new DelayQueue&lt;&gt;();</span><br><span class="line">        priorityTaskQueue = new PriorityBlockingQueue&lt;&gt;(queueCapacity);</span><br><span class="line">        </span><br><span class="line">        // 初始化线程池</span><br><span class="line">        executorService = Executors.newFixedThreadPool(workerThreads, new ThreadFactory() &#123;</span><br><span class="line">            private final AtomicInteger counter = new AtomicInteger(1);</span><br><span class="line">            </span><br><span class="line">            @Override</span><br><span class="line">            public Thread newThread(Runnable r) &#123;</span><br><span class="line">                Thread thread = new Thread(r, &quot;task-worker-&quot; + counter.getAndIncrement());</span><br><span class="line">                thread.setDaemon(true);</span><br><span class="line">                return thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 初始化分发器线程，</span><br><span class="line">        dispatcherService = Executors.newSingleThreadExecutor(r -&gt; &#123;</span><br><span class="line">            Thread thread = new Thread(r, &quot;task-dispatcher&quot;);</span><br><span class="line">            thread.setDaemon(true);</span><br><span class="line">            return thread;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 初始化信号量</span><br><span class="line">        taskSemaphore = new Semaphore(maxConcurrentTasks);</span><br><span class="line">        </span><br><span class="line">        // 初始化随机数生成器</span><br><span class="line">        random = new Random();</span><br><span class="line">        </span><br><span class="line">        // 启动任务分发线程</span><br><span class="line">        dispatcherService.submit(new TaskDispatcher());</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;任务调度器初始化完成，最大并发任务数: &#123;&#125;, 队列容量: &#123;&#125;, 最大延迟分钟数: &#123;&#125;, 工作线程数: &#123;&#125;&quot;, </span><br><span class="line">                maxConcurrentTasks, queueCapacity, maxDelayMinutes, workerThreads);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PreDestroy</span><br><span class="line">    public void shutdown() &#123;</span><br><span class="line">        // 关闭调度器</span><br><span class="line">        if (dispatcherService != null) &#123;</span><br><span class="line">            dispatcherService.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 关闭执行器</span><br><span class="line">        if (executorService != null) &#123;</span><br><span class="line">            executorService.shutdown();</span><br><span class="line">            try &#123;</span><br><span class="line">                if (!executorService.awaitTermination(30, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                    executorService.shutdownNow();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                executorService.shutdownNow();</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;任务调度器已关闭，总接收任务数: &#123;&#125;, 总执行任务数: &#123;&#125;&quot;, </span><br><span class="line">                totalTasksReceived.get(), totalTasksExecuted.get());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 提交任务到延迟队列</span><br><span class="line">    */</span><br><span class="line">    private void submitToDelayQueue(Runnable task, String taskId, String jobParams) &#123;</span><br><span class="line">        // 随机延迟时间，在0到maxDelayMinutes分钟之间</span><br><span class="line">        long delayMs = random.nextInt((int) TimeUnit.MINUTES.toMillis(maxDelayMinutes));</span><br><span class="line">        DelayedTask delayedTask = new DelayedTask(task, delayMs, taskId, jobParams);</span><br><span class="line">        delayedTaskQueue.offer(delayedTask);</span><br><span class="line">        totalTasksReceived.incrementAndGet();</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;任务已提交到延迟队列: &#123;&#125;, 延迟: &#123;&#125;ms&quot;, taskId, delayMs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 提交任务到优先级队列</span><br><span class="line">    */</span><br><span class="line">    private void submitToPriorityQueue(Runnable task, TaskPriority priority, String taskId, String jobParams) &#123;</span><br><span class="line">        PriorityTask priorityTask = new PriorityTask(task, priority, taskId, jobParams);</span><br><span class="line">        priorityTaskQueue.offer(priorityTask);</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;任务已提交到优先级队列: &#123;&#125;, 优先级: &#123;&#125;&quot;, taskId, priority);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 获取任务类型对应的优先级</span><br><span class="line">    */</span><br><span class="line">    private TaskPriority getTaskPriority(String taskId) &#123;</span><br><span class="line">        switch (taskId) &#123;</span><br><span class="line">            case TASK_SAFETY_NOTICE_ID:</span><br><span class="line">            case TASK_PUSH_SERVICE_STATUS_ID:</span><br><span class="line">                return TaskPriority.HIGH;</span><br><span class="line">            case TASK_TENANT_SERVICE_PHASE_ID:</span><br><span class="line">            case TASK_WEEKLY_SUMMARY:</span><br><span class="line">                return TaskPriority.MEDIUM;</span><br><span class="line">            default:</span><br><span class="line">                return TaskPriority.LOW;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 创建可执行的任务</span><br><span class="line">    */</span><br><span class="line">    private Runnable createExecutableTask(String taskId, String jobParams, TaskContext taskContext) &#123;</span><br><span class="line">        switch (taskId) &#123;</span><br><span class="line">            case TASK_SAFETY_NOTICE_ID:</span><br><span class="line">                return () -&gt; generateXxxTask(taskContext);</span><br><span class="line">            case TASK_OTHER:</span><br><span class="line">                return () -&gt; generateOtherTask(taskContext);</span><br><span class="line">            ...</span><br><span class="line">            default:</span><br><span class="line">                throw new IllegalArgumentException(&quot;未知的任务类型: &quot; + taskId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 通用任务提交方法</span><br><span class="line">    */</span><br><span class="line">    private ProcessResult submitTask(String taskId, TaskContext taskContext) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            totalTasksReceived.incrementAndGet();</span><br><span class="line">            </span><br><span class="line">            // 检查任务执行情况，如果已有大量相同类型任务，加入延迟队列</span><br><span class="line">            int activeCount = taskExecutionCount.computeIfAbsent(taskId, k -&gt; new AtomicInteger(0)).get();</span><br><span class="line">            if (activeCount &gt; maxConcurrentTasks / 2) &#123;</span><br><span class="line">                log.warn(&quot;当前任务类型 &#123;&#125; 正在执行的数量较多: &#123;&#125;, 将使用延迟队列分散负载&quot;, taskId, activeCount);</span><br><span class="line">                submitToDelayQueue(createExecutableTask(taskId, taskContext.getJobParams(), taskContext), taskId, taskContext.getJobParams());</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // 根据任务类型分配优先级</span><br><span class="line">                TaskPriority priority = getTaskPriority(taskId);</span><br><span class="line">                submitToPriorityQueue(createExecutableTask(taskId, taskContext.getJobParams(), taskContext), priority, taskId, taskContext.getJobParams());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            return new ProcessResult(true, formatResponse(SUCCESS, taskId));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;提交任务异常: &#123;&#125;&quot;, taskId, e);</span><br><span class="line">            return new ProcessResult(false, formatResponse(e.getMessage(), taskId));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ====== 以下是原始的PowerJob任务处理方法，改为使用队列系统 ======</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 告警任务</span><br><span class="line">    */</span><br><span class="line">    @PowerJobHandler(name = TASK_OTHER)</span><br><span class="line">    public ProcessResult generateOtherTask(TaskContext taskContext) &#123;</span><br><span class="line">        log.info(&quot;==================== 调度触发(其它任务) ======================&quot;);</span><br><span class="line">        return submitTask(TASK_OTHER, taskContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ProcessResult generateOtherTask(TaskContext taskContext) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            StrategyJobParams jobParams = new StrategyJobParams();</span><br><span class="line">            if (StringUtils.hasLength(taskContext.getJobParams())) &#123;</span><br><span class="line">                jobParams = OBJECT_MAPPER.readValue(taskContext.getJobParams(), StrategyJobParams.class);</span><br><span class="line">            &#125;</span><br><span class="line">            strategyScheduleService.generateTask(jobParams);</span><br><span class="line">            totalTasksExecuted.incrementAndGet();</span><br><span class="line">            return new ProcessResult(true, formatResponse(SUCCESS, TASK_OTHER));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;调度执行【其它任务】异常&quot;, e);</span><br><span class="line">            return new ProcessResult(false, formatResponse(e.getMessage(), TASK_OTHER));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 生成平安通告</span><br><span class="line">    */</span><br><span class="line">    @PowerJobHandler(name = TASK_SAFETY_NOTICE_ID)</span><br><span class="line">    public ProcessResult generateXxx(TaskContext taskContext) &#123;</span><br><span class="line">        log.info(&quot;==================== 调度触发(平安通告) ======================&quot;);</span><br><span class="line">        return submitTask(TASK_SAFETY_NOTICE_ID, taskContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ProcessResult generateXxxTask(TaskContext taskContext) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 获取调度任务的参数</span><br><span class="line">            StrategyJobParams jobParams = null;</span><br><span class="line">            if (StringUtils.hasLength(taskContext.getJobParams())) &#123;</span><br><span class="line">                jobParams = OBJECT_MAPPER.readValue(taskContext.getJobParams(), StrategyJobParams.class);</span><br><span class="line">            &#125;</span><br><span class="line">            // 生成平安通告</span><br><span class="line">            XxxScheduleService.autoGenerateBatch(jobParams);</span><br><span class="line">            totalTasksExecuted.incrementAndGet();</span><br><span class="line">            return new ProcessResult(true, formatResponse(&quot;success&quot;, TASK_SAFETY_NOTICE_ID));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;调度执行【平安通告】异常&quot;, e);</span><br><span class="line">            return new ProcessResult(false, formatResponse(e.getMessage(), TASK_SAFETY_NOTICE_ID));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private String formatResponse(String info, String id) &#123;</span><br><span class="line">        return String.format(&quot;&#123;\&quot;taskId\&quot;: \&quot;%s\&quot;, \&quot;info\&quot;: \&quot;%s\&quot;&#125;&quot;, id, info);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h2 id="解法设计2-0"><a href="#解法设计2-0" class="headerlink" title="解法设计2.0"></a>解法设计2.0</h2><p>主要是解决一些异常场景，比如：</p>
<ol>
<li>服务异常重启，任务丢了？</li>
<li>信号量获取阻塞，所有任务堆积？</li>
<li>发生异常，及时感知等</li>
</ol>
<p>这一步还停留在设计阶段，也可能是我设计并落地，也先做个记录。</p>
<p>解法：</p>
<ol>
<li>Redis代替内存队列，开启持久话，便于启动后恢复。</li>
<li>核心业务单独维护信号量</li>
<li>设置拒绝策略，当队列超过阈值直接异常返回给powerjob<ol>
<li>同时发送告警</li>
</ol>
</li>
<li>适当的动态调整信号量</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Gamehu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script>
  <script>
      pbOptions = {};
        pbOptions.iconStyle = "box";
        pbOptions.boxForm = "horizontal";
        pbOptions.position = "bottomCenter";
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      new needShareButton('#needsharebutton-postbottom', pbOptions);
  </script>
</body>
</html>
